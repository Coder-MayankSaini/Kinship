<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <meta name="theme-color" content="#2563eb">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <title>My Profile - Kinship</title>

    <!-- Favicon -->
    <link rel="icon" type="image/png" sizes="32x32" href="assets/images/favicon.png">
    <link rel="icon" type="image/png" sizes="16x16" href="assets/images/favicon.png">
    <link rel="apple-touch-icon" href="assets/images/favicon.png">
    <link rel="shortcut icon" href="assets/images/favicon.png">

    <link rel="stylesheet" href="css/base.css">
    <link rel="stylesheet" href="css/navigation.css">
    <link rel="stylesheet" href="css/profile.css">
    <link rel="stylesheet" href="css/components.css">
    <link rel="stylesheet" href="css/responsive.css">
</head>

<body>
    <header>
        <nav class="navbar">
            <div class="nav-container">
                <div class="nav-logo">
                    <a href="index.html">
                        <img src="assets/images/kinship_logo.webp" alt="Kinship" class="logo-image">
                    </a>
                </div>
                <ul class="nav-menu" id="nav-menu" aria-hidden="true">
                    <li><a href="index.html">Home</a></li>
                    <li><a href="browse.html">Browse</a></li>
                    <li><a href="list-item.html">List Item</a></li>
                    <li><a href="profile.html" class="active">Profile</a></li>
                    <li><a href="auth.html">Login</a></li>
                </ul>
                <button class="hamburger" aria-label="Toggle navigation menu" aria-expanded="false"
                    aria-controls="nav-menu">
                    <span></span>
                    <span></span>
                    <span></span>
                </button>
            </div>
        </nav>
    </header>

    <main class="profile-page">
        <div class="profile-header">
            <div class="profile-info">
                <div class="profile-avatar" id="profile-avatar-container" title="Click to change avatar">
                    <img id="user-avatar" src="assets/images/default-avatar.jpg" alt="User Avatar">
                </div>
                <div class="profile-details">
                    <h1 id="user-name">Loading...</h1>
                    <p id="user-email">Loading...</p>
                </div>
            </div>
        </div>

        <div class="profile-content">
            <div class="profile-tabs">
                <button class="tab-btn active" data-tab="listings">My Listings</button>
                <button class="tab-btn" data-tab="rentals">My Rentals</button>
                <button class="tab-btn" data-tab="bookings">Booking Requests</button>
                <button class="tab-btn" data-tab="favorites">Favorites</button>
                <button class="tab-btn" data-tab="reviews">Reviews</button>
                <button class="tab-btn" data-tab="settings">Settings</button>
            </div>

            <div class="tab-content">
                <!-- My Listings Tab -->
                <div class="tab-panel active" id="listings-panel">
                    <div class="panel-header">
                        <h2>My Listings</h2>
                        <a href="list-item.html" class="add-item-btn">+ Add New Item</a>
                    </div>
                    <div class="items-grid" id="user-listings">
                        <!-- User's listings will be populated by JavaScript -->
                    </div>
                </div>

                <!-- My Rentals Tab -->
                <div class="tab-panel" id="rentals-panel">
                    <h2>My Rentals</h2>
                    <div class="rentals-sections">
                        <div class="rental-section">
                            <h3>Current Rentals</h3>
                            <div class="rentals-list" id="current-rentals">
                                <!-- Current rentals will be populated by JavaScript -->
                            </div>
                        </div>

                        <div class="rental-section">
                            <h3>Past Rentals</h3>
                            <div class="rentals-list" id="past-rentals">
                                <!-- Past rentals will be populated by JavaScript -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Booking Requests Tab -->
                <div class="tab-panel" id="bookings-panel">
                    <h2>Booking Requests</h2>
                    <div class="booking-sections">
                        <div class="booking-section">
                            <h3>Pending Requests</h3>
                            <div class="booking-requests-list" id="pending-bookings">
                                <!-- Pending booking requests will be populated by JavaScript -->
                            </div>
                        </div>

                        <div class="booking-section">
                            <h3>All Bookings</h3>
                            <div class="booking-requests-list" id="all-bookings">
                                <!-- All booking requests will be populated by JavaScript -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Favorites Tab -->
                <div class="tab-panel" id="favorites-panel">
                    <h2>Favorite Items</h2>
                    <div class="items-grid" id="favorite-items">
                        <!-- Favorite items will be populated by JavaScript -->
                    </div>
                </div>

                <!-- Reviews Tab -->
                <div class="tab-panel" id="reviews-panel">
                    <h2>Reviews</h2>
                    <div class="review-sections">
                        <div class="review-section">
                            <h3>Reviews I've Written</h3>
                            <div class="reviews-list" id="written-reviews">
                                <!-- Reviews written by user will be populated by JavaScript -->
                            </div>
                        </div>

                        <div class="review-section">
                            <h3>Reviews About My Items</h3>
                            <div class="reviews-list" id="received-reviews">
                                <!-- Reviews received by user will be populated by JavaScript -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Settings Tab -->
                <div class="tab-panel" id="settings-panel">
                    <h2>Account Settings</h2>
                    <form class="settings-form" id="settings-form">
                        <div class="form-group">
                            <label for="settings-name">Full Name</label>
                            <input type="text" id="settings-name" name="name">
                        </div>

                        <div class="form-group">
                            <label for="settings-email">Email</label>
                            <input type="email" id="settings-email" name="email">
                        </div>

                        <div class="form-group">
                            <label for="settings-phone">Phone Number</label>
                            <input type="tel" id="settings-phone" name="phone">
                        </div>

                        <div class="form-group">
                            <label for="settings-location">Location</label>
                            <input type="text" id="settings-location" name="location">
                        </div>

                        <div class="form-group">
                            <label for="settings-bio">Bio</label>
                            <textarea id="settings-bio" name="bio" rows="4"></textarea>
                        </div>

                        <div class="form-actions">
                            <button type="submit" class="save-btn">Save Changes</button>
                            <button type="button" class="logout-btn" id="logout-btn">Logout</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </main>

    <!-- Change Avatar Modal -->
    <div class="modal" id="change-avatar-modal">
        <div class="modal-content">
            <span class="close" id="close-avatar-modal">&times;</span>
            <h2>Change Avatar</h2>

            <div class="avatar-options">
                <h3>Choose a Style:</h3>
                <div class="avatar-styles">
                    <button class="avatar-style-btn active" data-style="avataaars">Avataaars</button>
                    <button class="avatar-style-btn" data-style="personas">Personas</button>
                    <button class="avatar-style-btn" data-style="bottts">Robots</button>
                    <button class="avatar-style-btn" data-style="identicon">Geometric</button>
                </div>

                <h3>Preview:</h3>
                <div class="avatar-preview">
                    <img id="avatar-preview-img" src="" alt="Avatar Preview">
                </div>

                <div class="avatar-actions">
                    <button type="button" class="btn-secondary" id="generate-new-avatar">Generate New</button>
                    <button type="button" class="btn-primary" id="save-avatar">Save Avatar</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Core modules -->
    <script src="js/utils.js"></script>
    <script src="js/storage.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/search.js"></script>
    <script src="js/booking.js"></script>
    <script src="js/components.js"></script>
    <script src="js/sample-data.js"></script>

    <!-- Navigation and routing -->
    <script src="js/router.js"></script>

    <!-- Navbar cleanup -->
    <script src="js/navbar-cleanup.js"></script>

    <!-- Page-specific modules -->
    <script src="js/profile.js"></script>

    <!-- Accessibility enhancements -->
    <script src="js/accessibility.js"></script>

    <!-- Pirate theme animations -->
    <script src="js/pirate-animations.js"></script>

    <!-- Application finalization -->
    <script src="js/app-finalizer.js"></script>

    <!-- Main application -->
    <script src="js/main.js"></script>

    <!-- Inline tab initialization as fallback -->
    <script>
        console.log('Inline tab script loaded');

        function initializeProfileTabs() {
            console.log('Initializing profile tabs inline...');

            const tabButtons = document.querySelectorAll('.profile-tabs .tab-btn');
            const tabPanels = document.querySelectorAll('.tab-panel');

            console.log('Found', tabButtons.length, 'tab buttons');
            console.log('Found', tabPanels.length, 'tab panels');

            if (tabButtons.length === 0 || tabPanels.length === 0) {
                console.error('Tab elements not found!');
                return;
            }

            // Set initial state
            tabPanels.forEach(panel => {
                panel.classList.remove('active');
                panel.style.display = 'none';
            });

            tabButtons.forEach(btn => btn.classList.remove('active'));

            // Activate first tab
            if (tabButtons[0] && tabPanels[0]) {
                tabButtons[0].classList.add('active');
                tabPanels[0].classList.add('active');
                tabPanels[0].style.display = 'block';
                console.log('First tab activated');
            }

            // Add click handlers
            tabButtons.forEach((button, index) => {
                console.log(`Setting up button ${index}: ${button.dataset.tab}`);

                button.addEventListener('click', function (e) {
                    e.preventDefault();
                    e.stopPropagation();

                    const targetTab = this.dataset.tab;
                    console.log('Tab clicked:', targetTab);

                    // Remove active from all
                    tabButtons.forEach(btn => btn.classList.remove('active'));
                    tabPanels.forEach(panel => {
                        panel.classList.remove('active');
                        panel.style.display = 'none';
                    });

                    // Add active to clicked
                    this.classList.add('active');

                    const targetPanel = document.getElementById(`${targetTab}-panel`);
                    if (targetPanel) {
                        targetPanel.classList.add('active');
                        targetPanel.style.display = 'block';
                        console.log('Panel activated:', targetPanel.id);
                    } else {
                        console.error('Panel not found:', `${targetTab}-panel`);
                    }
                });
            });

            console.log('Profile tabs initialized successfully');
        }

        // Try multiple initialization methods
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initializeProfileTabs);
        } else {
            initializeProfileTabs();
        }

        // Also try after a short delay
        setTimeout(initializeProfileTabs, 100);
        setTimeout(initializeProfileTabs, 500);

        // Make it available globally for manual testing
        window.initializeProfileTabs = initializeProfileTabs;
    </script>
</body>

</html>