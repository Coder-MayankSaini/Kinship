<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <meta name="theme-color" content="#2563eb">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <title>Login & Register - Kinship</title>

    <!-- Favicon -->
    <link rel="icon" type="image/png" sizes="32x32" href="assets/images/favicon.png">
    <link rel="icon" type="image/png" sizes="16x16" href="assets/images/favicon.png">
    <link rel="apple-touch-icon" href="assets/images/favicon.png">
    <link rel="shortcut icon" href="assets/images/favicon.png">

    <link rel="stylesheet" href="css/base.css">
    <link rel="stylesheet" href="css/navigation.css">
    <link rel="stylesheet" href="css/auth.css">
    <link rel="stylesheet" href="css/components.css">
    <link rel="stylesheet" href="css/responsive.css">
</head>

<body>
    <header>
        <nav class="navbar">
            <div class="nav-container">
                <div class="nav-logo">
                    <a href="index.html">
                        <img src="assets/images/kinship_logo.webp" alt="Kinship" class="logo-image">
                    </a>
                </div>
                <ul class="nav-menu" id="nav-menu" aria-hidden="true">
                    <li><a href="index.html">Home</a></li>
                    <li><a href="browse.html">Browse</a></li>
                    <li><a href="list-item.html">List Item</a></li>
                    <li><a href="profile.html">Profile</a></li>
                    <li><a href="auth.html" class="active">Login</a></li>
                </ul>
                <button class="hamburger" aria-label="Toggle navigation menu" aria-expanded="false"
                    aria-controls="nav-menu">
                    <span></span>
                    <span></span>
                    <span></span>
                </button>
            </div>
        </nav>
    </header>

    <main class="simple-auth-page">
        <div class="simple-auth-container">
            <div class="auth-header">
                <img src="assets/images/kinship_logo.webp" alt="Kinship" class="auth-logo">
                <p>Sign in to your account</p>
            </div>

            <!-- Simple Login Form -->
            <div class="simple-auth-form">
                <form id="login-form" class="simple-form">
                    <div class="form-group">
                        <label for="login-email">Email</label>
                        <input type="email" id="login-email" name="email" required placeholder="Enter your email"
                            autocomplete="email">
                    </div>

                    <div class="form-group">
                        <label for="login-password">Password</label>
                        <input type="password" id="login-password" name="password" required
                            placeholder="Enter your password" autocomplete="current-password">
                    </div>

                    <button type="submit" class="simple-btn">Sign In</button>

                    <div class="auth-links">
                        <a href="#" class="forgot-link">Forgot password?</a>
                        <span>â€¢</span>
                        <a href="#" class="signup-link" onclick="showRegister()">Create account</a>
                    </div>
                </form>

                <!-- Simple Register Form (Hidden by default) -->
                <form id="register-form" class="simple-form" style="display: none;">
                    <div class="form-group">
                        <label for="register-name">Full Name</label>
                        <input type="text" id="register-name" name="name" required placeholder="Enter your full name">
                    </div>

                    <div class="form-group">
                        <label for="register-email">Email</label>
                        <input type="email" id="register-email" name="email" required placeholder="Enter your email">
                    </div>

                    <div class="form-group">
                        <label for="register-password">Password</label>
                        <input type="password" id="register-password" name="password" required
                            placeholder="Create a password" minlength="8">
                    </div>

                    <button type="submit" class="simple-btn">Create Account</button>

                    <div class="auth-links">
                        <a href="#" class="signin-link" onclick="showLogin()">Already have an account? Sign in</a>
                    </div>
                </form>
            </div>
        </div>
    </main>

    <!-- Simple JavaScript for form switching -->
    <script>
        function showRegister() {
            document.getElementById('login-form').style.display = 'none';
            document.getElementById('register-form').style.display = 'block';
            document.querySelector('.auth-header p').textContent = 'Create a new account';
        }

        function showLogin() {
            document.getElementById('register-form').style.display = 'none';
            document.getElementById('login-form').style.display = 'block';
            document.querySelector('.auth-header p').textContent = 'Sign in to your account';
        }

        // Enhanced form switching with proper integration
        document.addEventListener('DOMContentLoaded', function () {
            console.log('DOM loaded, checking modules...');
            
            // Force initialization of modules if they're not ready
            function initializeModules() {
                // Check and initialize Utils
                if (typeof UtilityManager !== 'undefined' && !window.KinshipUtils) {
                    window.KinshipUtils = new UtilityManager();
                    console.log('Initialized KinshipUtils');
                }
                
                // Check and initialize Storage
                if (typeof StorageManager !== 'undefined' && !window.KinshipStorage) {
                    window.KinshipStorage = new StorageManager();
                    console.log('Initialized KinshipStorage');
                }
                
                // Check and initialize Auth
                if (typeof AuthManager !== 'undefined' && !window.KinshipAuth) {
                    window.KinshipAuth = new AuthManager();
                    console.log('Initialized KinshipAuth');
                }
                
                // Verify all modules are loaded
                if (window.KinshipAuth && window.KinshipStorage && window.KinshipUtils) {
                    console.log('All modules initialized successfully');
                    return true;
                }
                return false;
            }
            
            // Try to initialize immediately
            let initialized = initializeModules();
            
            // If not initialized, try again after a delay
            if (!initialized) {
                console.log('Modules not ready, trying again in 500ms...');
                setTimeout(function() {
                    initialized = initializeModules();
                    if (!initialized) {
                        console.error('Failed to initialize modules after retry');
                    }
                }, 500);
            }
            
            // Ensure auth system is ready
            if (window.KinshipAuth) {
                console.log('Auth system loaded successfully');
            }

            // Add event listeners for form switching
            const signupLinks = document.querySelectorAll('.signup-link');
            const signinLinks = document.querySelectorAll('.signin-link');

            signupLinks.forEach(link => {
                link.addEventListener('click', function (e) {
                    e.preventDefault();
                    showRegister();
                });
            });

            signinLinks.forEach(link => {
                link.addEventListener('click', function (e) {
                    e.preventDefault();
                    showLogin();
                });
            });

            // Check if user is already logged in
            setTimeout(() => {
                if (window.KinshipAuth && window.KinshipAuth.isAuthenticated()) {
                    console.log('User already authenticated, redirecting to index.html');
                    // Use multiple redirect methods for reliability
                    try {
                        window.location.href = 'index.html';
                    } catch (e) {
                        console.error('Redirect failed:', e);
                        window.location.replace('index.html');
                    }
                }
            }, 100);

            // Add global error handler
            window.addEventListener('error', function(e) {
                console.error('Global error:', e);
            });
        });
    </script>

    <!-- Core modules -->
    <script src="js/utils.js"></script>
    <script src="js/storage.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/init.js"></script>
    <script src="js/search.js"></script>
    <script src="js/booking.js"></script>
    <script src="js/components.js"></script>
    <script src="js/sample-data.js"></script>

    <!-- Navigation and routing -->
    <script src="js/router.js"></script>

    <!-- Navbar cleanup -->
    <script src="js/navbar-cleanup.js"></script>

    <!-- Accessibility enhancements -->
    <script src="js/accessibility.js"></script>

    <!-- Pirate theme animations -->
    <script src="js/pirate-animations.js"></script>

    <!-- Application finalization -->
    <script src="js/app-finalizer.js"></script>

    <!-- Main application -->
    <script src="js/main.js"></script>
</body>

</html>